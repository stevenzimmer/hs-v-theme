{# Create array of menu items #}
{% set menuItemArray = [] %}
{# Create array of icon items #}
{% set iconArray = [] %}


{# Loop over and render each menu item #}
{% macro render_menu_item(link,depth)%}
  {# Wrapping div for each level of nesting #}  
  <div class="level-{{ depth }} {{'has-children' if link.children else 'no-children'}} {{'active' if link.activeBranch or link.activeNode }}" role="none" {{'aria-haspopup="true"' if link.children}}> 
    {# Loop for top level and has child nodes #}  
    {% if link.children && depth == 1 %}
      <p class="nav-item level-{{ depth }} {{'has-link' if link.url else 'no-link'}}" role="menuitem">{{link.label}}{% if link.children && depth == 1 %}<svg focusable="false" width="20" height="20" viewBox="0 0 24 24" aria-hidden="true"><path d="M7 10l5 5 5-5z" fill="#ffffff"></path></svg>{% endif %}</p>
      <div class="dropdown-wrapper" role="menu">
        {% set depth = depth + 1 %}
        {% for link in link.children %}
          {{render_menu_item(link,depth)}}
        {% endfor %}
      </div>
    {# Loop for nested #}
    {% elif depth != 1 %}
      {# Loop through icons and see if it matches the node label #}
      {% if link.url %}
        <a class="link-wrapper" href="{{ link.url }}">
          {% for item in module.icon %}
            {% if link.label == item.navigation_item  %}
              <div class="icon-wrapper">
                <img src="{{ item.icon.src }}" alt="{{ item.icon.alt }}" width="auto" height="20">
              </div>
            {% endif %}
          {% endfor %}
          <p class="nav-item level-{{ depth }} has-link" role="menuitem">{{link.label}}</p>
        </a>
      {% else %}
        <div class="link-wrapper">
          {% for item in module.icon %}
            {% if link.label == item.navigation_item  %}
              <div class="icon-wrapper">
                <img src="{{ item.icon.src }}" alt="{{ item.icon.alt }}" width="auto" height="20">
              </div>
            {% endif %}
          {% endfor %}
          <p class="nav-item level-{{ depth }} no-link" role="menuitem">{{link.label}}</p>
        </div>
      {% endif %}
      {% set depth = depth + 1 %}
      {% for link in link.children %}
        {{render_menu_item(link,depth)}}
      {% endfor %}
    {% else %}
      <a class="nav-item level-{{ depth }} has-link" href="{{ link.url }}" role="menuitem">{{link.label}}</a>
    {% endif %}
  </div>
{% endmacro %}

{% set menu = menu(module.select_menu , "site_root").children %}

<div class="navigation-container bg-v-purple">
  <div class="grid">
    <nav class="f-dir-row f-justify-between navigation-wrapper" role="navigation" aria-label="Desktop">
      <a href="https://www.verta.ai/" class="f-dir-col f-align-center f-justify-center logo">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 150 46.906662" width="75" xml:space="preserve">
          <title>Verta Logo</title>
          <g id="Artwork">
            <path class="logo-path" d="M66.7604599 14.8775587c-2.6799316-2.9599609-6.4099159-4.4501953-11.199955-4.4501953-2.0400391 0-4.0400391.3901367-5.9899902 1.1699219-1.1098633.4404297-2.1401367 1-3.1098633 1.6904297L39.470417 30.8575382c.1401367 1.8398457.4702148 3.5698261.9902344 5.1899433.7099609 2.1899414 1.7998047 4.0898438 3.2597656 5.7099609s3.3300781 2.8798828 5.5900879 3.7900391 4.9199219 1.3598633 7.9799805 1.3598633c1.1899414 0 2.369873-.0698242 3.5200195-.199707s2.2299805-.300293 3.2299843-.5c.9899902-.2001953 1.880127-.4199219 2.6599121-.6601562.7700195-.25 1.380127-.4799805 1.8300781-.7001953l-1.0698242-6.5800781c-.9301758.4003906-2.2001953.7802734-3.8200722 1.1303711-1.6201172.3598633-3.4001465.5297852-5.3601074.5297852-3.3198242 0-5.8598633-.7597656-7.6098633-2.2900391-1.75-1.5297852-2.7402344-3.6899414-2.9599609-6.4799824h22.9399452c.0498047-.4399414.079834-.9399414.0998535-1.4897461.0300293-.5600586.0400391-1.050293.0400391-1.5 0-5.8901368-1.3498535-10.3203126-4.0300293-13.2900382zM47.7804756 25.2476749c.1298828-1.0200195.3701172-2.0200195.7299805-2.9902344.3500977-.9697266.8500977-1.8398438 1.5-2.5898438.6401367-.75 1.4301758-1.3603516 2.3601074-1.8300781.9299316-.4599609 2.0100098-.6899414 3.25-.6899414v-.0102539c1.1999512 0 2.2299805.2099609 3.0998535.6298828.8601074.4301758 1.5900879 1 2.1899414 1.7304688.6000977.7299805 1.050293 1.5996094 1.3601074 2.5898438.3200684 1 .4699707 2.0498047.4699707 3.1601562H47.7804756zM107.3699265.7965602v10.4986563h12.3681183v6.7102785h-12.3681183v14.1505375c0 2.7913284.4431305 4.7854233 1.3293991 5.9802971.8862686 1.1968498 2.3936996 1.7942848 4.522316 1.7942848 1.463913 0 2.7596817-.1562843 3.889267-.4648933 1.1315613-.310585 2.0277252-.597435 2.694397-.864502l1.3293991 6.3779259c-.9297943.3996086-2.150383.8091125-3.657814 1.2304802-1.5074387.4193954-3.2799683.6310692-5.3195572.6310692-2.4827271 0-4.5559464-.3323479-6.2176895-.9970474-1.6617432-.6646957-2.9812469-1.628109-3.9565353-2.8882637-.9752808-1.2660904-1.6617432-2.7933121-2.061348-4.5856209-.3996124-1.7942886-.5994186-3.8437729-.5994186-6.1464729V2.1259551l8.0475844-1.3293949zM149.3004913 18.5674992c-.4699707-1.7001953-1.2399902-3.1499014-2.3300781-4.3500967-1.079834-1.2001953-2.5400391-2.1298828-4.3498535-2.7900391-1.8200684-.6601562-4.0600586-1-6.7199707-1-2.2202148 0-4.3000488.1801758-6.25.5400391-1.9501877.3500977-3.4399338.7001953-4.4501877 1.0600586l.9902344 6.510253c.9799805-.3603516 2.2397385-.6601562 3.7897873-.9301758s3.2600098-.3999023 5.1201172-.3999023c1.3798828 0 2.5200195.1796875 3.4299316.5297852.9101562.3598633 1.6401367.8500977 2.1899414 1.5.5600586.6401367.9399414 1.3798828 1.170166 2.2202148.2199707.8398438.329834 1.7299805.329834 2.659668v1.3300781c-1.1098633-.2700195-2.1499023-.449707-3.1298828-.5698242-.9699707-.1103516-1.8999023-.1601562-2.7900391-.1601562-1.9099121 0-3.7399902.1899414-5.4899902.5600586-1.75.3798828-3.2900314 1-4.6198654 1.8598633-1.3300781.8701172-2.380127 1.9902344-3.1601562 3.3603516-.7700195 1.3696289-1.1599121 3.0595722-1.1599121 5.0498066 0 2.0800781.3400879 3.8300781 1.0300293 5.25.6899414 1.4101562 1.6398926 2.5698242 2.8598633 3.4501953 1.2199707.8896484 2.6899338 1.5297852 4.4199142 1.9296875 1.7299805.4003906 3.6401367.6000977 5.7202148.6000977 3.1499023 0 5.9699707-.1899414 8.4799805-.5698242 2.5-.3798828 4.3798828-.7001953 5.619873-.9599609V24.1876163c0-2.040039-.2299805-3.9101562-.6999512-5.6201171zm-7.0800781 21.4301776c-1.2900391.2695312-3.1699219.3999023-5.6499023.3999023-2.0400391 0-3.6601562-.3701172-4.8598633-1.1000977-1.1901855-.7299805-1.7900391-2.0498047-1.7900391-3.9501953 0-.9799805.2199707-1.7797852.6599121-2.4296875.4499512-.6401367 1.0300293-1.1401386 1.7600098-1.4902363.7399902-.3598633 1.5500488-.5996094 2.4599609-.7299805.9101562-.1401367 1.8100586-.199707 2.6999512-.199707 1.0200195 0 1.9499512.0595703 2.7900391.199707.8400879.1303711 1.4899902.2602539 1.9299316.3999023v8.9003927zM89.6743393 10.5632582c.5321579 0 1.1533279.0336313 1.861557.0989141.7101974.0672607 1.4184113.1562834 2.1286087.267066.7082214.1107836 1.3966599.2433271 2.0613556.3976316.6646957.1562834 1.196846.3006964 1.5964584.4332399l-1.3966599 6.7755594c-.6646957-.2215672-1.5845871-.4549999-2.7596817-.6963501-1.1750946-.2433281-2.5381165-.3659801-4.0890732-.3659801-.8882446 0-1.829895.0890217-2.8269424.2650871-.9970551.1780434-1.6953735.3323498-2.094986.4668713v27.8381519h-8.0456085V12.9549809c1.5509644-.5736971 3.4896622-1.1177197 5.8180847-1.6281128 2.3284226-.5084134 4.9100495-.7636109 7.7468873-.7636099zM9.243988-.0006807l3.2582045 9.5016108c1.1078291 3.2324858 2.2156572 6.4095812 3.3234863 9.5352411 1.1078291 3.1217041 2.2156572 6.1444931 3.3254633 9.0683708 1.10783 2.9218998 2.1958752 5.6024513 3.2582054 8.039669 1.0188065-2.4372215 2.0831146-5.1059036 3.1929207-8.0060406 1.10783-2.9021149 2.2275276-5.9249058 3.3571167-9.0703468 1.1315689-3.1454439 2.2492886-6.3344069 3.3590965-9.5668936 1.1078262-3.2344646 2.1721344-6.4016685 3.1909409-9.5016108h8.9773712c-2.7042885 7.8398671-5.5866203 15.6797342-8.6450233 23.5215797-3.0583954 7.8378887-6.251318 15.3454075-9.5748062 22.5225582h-8.0475845c-3.3234854-7.1771469-6.5282764-14.6846676-9.6084356-22.5245323S2.6603203 7.8391867-.0004472-.0006807H9.243988z"/>
          </g>
        </svg>
      </a>
      <div class="f-dir-row f-justify-between menu-wrapper">
        <div class="f-dir-row f-align-center menu" role="menu">
          {% for link in menu %}
            {{render_menu_item(link,1)}}
          {% endfor %}
        </div>
        <div class="cta-wrapper">
          {% set href = module.cta.link.url.href %}
          {% if module.cta.link.url.type is equalto "EMAIL_ADDRESS" %}
            {% set href = "mailto:" + href %}
          {% endif %}
          <a class="btn btn-secondary filled-blue sign_up_btn" href="{{ href }}"
          {% if module.cta.link.open_in_new_tab %}target="_blank"{% endif %}
          {% if module.cta.link.rel %}rel="{{ module.cta.link.rel }}"{% endif %}>{{ module.cta.cta_text }}</a>
        </div>
      </div>
      <div id="hamburgerButton" class="hamburger-wrapper">
        <div class="hamburger">
          <div class="bar-1"></div>
          <div class="bar-2"></div>
          <div class="bar-3"></div>
        </div>
      </div>
    </nav>
  </div>
</div>

<div id="mobileMenuContainer" class="mobile-menu-container">
  <div class="grid">
    <div class="mobile-menu-wrapper">
      <div class="f-dir-col f-align-center mobile-menu">
        {% for link in menu %}
          {{render_menu_item(link,1)}}
        {% endfor %}
      </div>
    </div>
  </div>     
</div>